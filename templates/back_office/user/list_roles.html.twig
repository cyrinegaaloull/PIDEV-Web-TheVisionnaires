<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>{% block title %}List of Roles{% endblock %}</title>
        {% block stylesheets %}
            <style>
                /* Flash message styles */
                .flash-message {
                    position: fixed;
                    bottom: -50px;
                    left: 50%;
                    transform: translateX(-50%);
                    padding: 15px 25px;
                    border-radius: 5px;
                    opacity: 0;
                    transition: all 0.5s ease;
                    z-index: 1000;
                }
                .flash-message.success {
                    background-color: #4CAF50;
                    color: white;
                }
                .flash-message.error,
                .flash-message.danger {
                    background-color: red;
                    color: white;
                }
                .flash-message.show {
                    bottom: 30px;
                    opacity: 1;
                }
                
                /* Modal overlay styles */
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 2000;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgba(0, 0, 0, 0.5);
                }
                /* Modal content styles */
                .modal-content {
                    background-color: #fefefe;
                    margin: 15% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 300px;
                    text-align: center;
                    border-radius: 10px;
                    position: relative;
                }
                .modal-content button {
                    margin: 10px;
                    padding: 8px 15px;
                    border: none;
                    border-radius: 5px;
                    cursor: pointer;
                }
                /* Close icon */
                .close {
                    position: absolute;
                    top: 10px;
                    right: 15px;
                    color: #aaa;
                    font-size: 28px;
                    font-weight: bold;
                    cursor: pointer;
                }
                .close:hover,
                .close:focus {
                    color: black;
                }
            </style>
        {% endblock %}
    </head>
    <body>
        {% block body %}
            {# Flash messages #}
            {% for label, messages in app.flashes %}
                {% for message in messages %}
                    <div class="flash-message {{ label }}" id="flash-message">{{ message }}</div>
                {% endfor %}
            {% endfor %}
            
            <h1>All Roles</h1>
            {% if roles is not empty %}
                <table border="1" cellspacing="0" cellpadding="5">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Role Name</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for role in roles %}
                            <tr>
                                <td>{{ role.id }}</td>
                                <td>{{ role.role }}</td>
                                <td>
                                    <a href="{{ path('update_role', {'id': role.id}) }}">
                                        <button type="button">Update</button>
                                    </a>
                                    <form action="{{ path('delete_role', {'id': role.id}) }}" method="post" style="display:inline">
                                        <input type="hidden" name="_token" value="{{ csrf_token('delete_role' ~ role.id) }}">
                                        <button type="submit" class="delete-button">Delete</button>
                                    </form>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p>No roles found.</p>
            {% endif %}
            <br>
            <a href="{{ path('add_role') }}">
                <button type="button">Back to Add Role</button>
            </a>
            
            <!-- Custom Modal for Delete Confirmation -->
            <div id="deleteModal" class="modal">
                <div class="modal-content">
                    <span class="close" id="modalClose">&times;</span>
                    <p>Are you sure you want to delete this role?</p>
                    <button id="confirmDelete" style="background-color: red; color: white;">Delete</button>
                    <button id="cancelDelete" style="background-color: gray; color: white;">Cancel</button>
                </div>
            </div>
        {% endblock %}
        {% block javascripts %}
            <script>
                window.addEventListener('DOMContentLoaded', () => {
                    // Flash message animation
                    const flashMessage = document.getElementById('flash-message');
                    if (flashMessage) {
                        setTimeout(() => flashMessage.classList.add('show'), 100);
                        setTimeout(() => flashMessage.classList.remove('show'), 3000);
                    }
                    
                    // Modal for delete confirmation
                    const modal = document.getElementById('deleteModal');
                    let formToSubmit = null;
                    
                    // Intercept delete button click
                    document.querySelectorAll('.delete-button').forEach(button => {
                        button.addEventListener('click', function(e) {
                            e.preventDefault();  // Prevent immediate form submission
                            formToSubmit = this.closest('form');
                            modal.style.display = 'block';  // Show modal
                        });
                    });
                    
                    // Confirm deletion: submit the form
                    document.getElementById('confirmDelete').addEventListener('click', () => {
                        if (formToSubmit) {
                            formToSubmit.submit();
                        }
                        modal.style.display = 'none';
                    });
                    
                    // Cancel deletion: hide the modal
                    document.getElementById('cancelDelete').addEventListener('click', () => {
                        modal.style.display = 'none';
                        formToSubmit = null;
                    });
                    
                    // Close modal when clicking on the close icon
                    document.getElementById('modalClose').addEventListener('click', () => {
                        modal.style.display = 'none';
                        formToSubmit = null;
                    });
                    
                    // Close modal if user clicks outside modal content
                    window.addEventListener('click', (event) => {
                        if (event.target == modal) {
                            modal.style.display = 'none';
                        }
                    });
                });
            </script>
        {% endblock %}
    </body>
</html>
